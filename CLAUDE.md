
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Common Development Commands

### Running the Application
```bash
# Start Expo development server
npm start

# Run on specific platforms
npm run ios      # iOS Simulator
npm run android  # Android Emulator
npm run web      # Web browser
```

### AWS Amplify Commands
```bash
# Initialize Amplify (first-time setup)
amplify init

# Deploy backend changes
amplify push

# Pull latest backend configuration
amplify pull

# Check Amplify status
amplify status
```

### Development Workflow
```bash
# Install dependencies
npm install

# Clear Expo cache (for build issues)
expo start -c

# Install specific Expo packages
expo install [package-name]
```

## Architecture Overview

### Tech Stack
- **Frontend**: React Native with Expo (managed workflow)
- **Backend**: AWS Amplify with GraphQL API
- **Audio**: Expo AV for recording and playback
- **State Management**: React Context API
- **Navigation**: React Navigation v6

### AWS Services Integration
The app heavily relies on AWS Amplify for backend services:
- **Authentication**: AWS Cognito user pools
- **API**: GraphQL with AWS AppSync (schema at `amplify/backend/api/littlebit/schema.graphql`)
- **Storage**: S3 for audio files (configured in `amplify/backend/storage/`)
- **Database**: DynamoDB (managed through GraphQL)
- **Functions**: Lambda functions in `amplify/backend/function/`
  - `CreateSampleRecord` (Node.js): Creates database records
  - `EditandConvertRecordings` (Python 3.8): Processes audio files

### Key Application Flows

1. **Audio Recording Flow**:
   - User initiates recording in `RecorderScreen`
   - Audio captured using Expo AV APIs
   - Recording saved to S3 via Amplify Storage
   - Metadata stored in DynamoDB via GraphQL mutation

2. **Authentication Flow**:
   - Managed by `UserContext` using AWS Cognito
   - Sign up includes email verification
   - Protected routes require authentication

3. **Data Flow**:
   - GraphQL subscriptions for real-time updates
   - Optimistic UI updates for better UX
   - S3 presigned URLs for secure audio access

### Critical Files and Patterns

- **API Services** (`src/api/`): Encapsulate Amplify operations
  - `authService.js`: Cognito authentication wrapper
  - `playbackService.js`: Audio playback management
  - `soundsService.js`: CRUD operations for audio samples

- **GraphQL Operations** (`src/graphql/`): Auto-generated by Amplify
  - Mutations, queries, and subscriptions for Sample model
  - Custom resolvers may be in `amplify/backend/api/littlebit/resolvers/`

- **Screen Components**: Each screen in `src/screens/` is self-contained
  - Use hooks from `src/hooks/` for shared logic
  - Import reusable components from `src/components/`

### Development Considerations

1. **Permissions**: Audio recording requires microphone permissions (handled automatically by Expo)

2. **Platform Differences**: 
   - Web platform has limited audio features
   - iOS requires special handling for silent mode (`playsInSilentMode`)

3. **AWS Configuration**:
   - `src/aws-exports.js` is auto-generated and contains sensitive config
   - Never commit AWS credentials or modify aws-exports.js manually

4. **Model Changes**: 
   - GraphQL schema changes require `amplify push` to update
   - This regenerates models in `src/models/`

5. **State Management**:
   - UserContext provides global auth state
   - Local component state for UI interactions
   - No Redux or MobX - keep state management simple